<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Specialized sliding functions — summary-slide • slider</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Specialized sliding functions — summary-slide"><meta name="description" content="These functions are specialized variants of the most common ways that
slide() is generally used. Notably, slide_sum() can be used for
rolling sums, and slide_mean() can be used for rolling averages.
These specialized variants are much faster and more memory efficient
than using an otherwise equivalent call constructed with slide_dbl()
or slide_lgl(), especially with a very wide window."><meta property="og:description" content="These functions are specialized variants of the most common ways that
slide() is generally used. Notably, slide_sum() can be used for
rolling sums, and slide_mean() can be used for rolling averages.
These specialized variants are much faster and more memory efficient
than using an otherwise equivalent call constructed with slide_dbl()
or slide_lgl(), especially with a very wide window."><meta name="robots" content="noindex"><script defer data-domain="slider.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">slider</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.3.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/slider.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/rowwise.html">Row-wise iteration with slider</a></li>
    <li><a class="dropdown-item" href="../articles/tsibble.html">Converting from tsibble</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/slider/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Specialized sliding functions</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/slider/blob/main/R/summary-slide.R" class="external-link"><code>R/summary-slide.R</code></a></small>
      <div class="d-none name"><code>summary-slide.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These functions are specialized variants of the most common ways that
<code><a href="slide.html">slide()</a></code> is generally used. Notably, <code>slide_sum()</code> can be used for
rolling sums, and <code>slide_mean()</code> can be used for rolling averages.</p>
<p>These specialized variants are <em>much</em> faster and more memory efficient
than using an otherwise equivalent call constructed with <code><a href="slide.html">slide_dbl()</a></code>
or <code><a href="slide.html">slide_lgl()</a></code>, especially with a very wide window.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">slide_sum</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  before <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  after <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  step <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  complete <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  na_rm <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">slide_prod</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  before <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  after <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  step <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  complete <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  na_rm <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">slide_mean</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  before <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  after <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  step <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  complete <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  na_rm <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">slide_min</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  before <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  after <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  step <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  complete <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  na_rm <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">slide_max</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  before <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  after <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  step <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  complete <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  na_rm <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">slide_all</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  before <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  after <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  step <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  complete <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  na_rm <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">slide_any</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">...</span>,</span>
<span>  before <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  after <span class="op">=</span> <span class="fl">0L</span>,</span>
<span>  step <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  complete <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  na_rm <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p><code>[vector]</code></p>
<p>A vector to compute the sliding function on.</p><ul><li><p>For sliding sum, mean, prod, min, and max, <code>x</code> will be cast to a double
vector with <code><a href="https://vctrs.r-lib.org/reference/vec_cast.html" class="external-link">vctrs::vec_cast()</a></code>.</p></li>
<li><p>For sliding any and all, <code>x</code> will be cast to a logical vector with
<code><a href="https://vctrs.r-lib.org/reference/vec_cast.html" class="external-link">vctrs::vec_cast()</a></code>.</p></li>
</ul></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>These dots are for future extensions and must be empty.</p></dd>


<dt id="arg-before-after">before, after<a class="anchor" aria-label="anchor" href="#arg-before-after"></a></dt>
<dd><p><code>[integer(1) / Inf]</code></p>
<p>The number of values before or after the current element to
include in the sliding window. Set to <code>Inf</code> to select all elements
before or after the current element. Negative values are allowed, which
allows you to "look forward" from the current element if used as the
<code>.before</code> value, or "look backwards" if used as <code>.after</code>.</p></dd>


<dt id="arg-step">step<a class="anchor" aria-label="anchor" href="#arg-step"></a></dt>
<dd><p><code>[positive integer(1)]</code></p>
<p>The number of elements to shift the window forward between function calls.</p></dd>


<dt id="arg-complete">complete<a class="anchor" aria-label="anchor" href="#arg-complete"></a></dt>
<dd><p><code>[logical(1)]</code></p>
<p>Should the function be evaluated on complete windows only? If <code>FALSE</code>,
the default, then partial computations will be allowed.</p></dd>


<dt id="arg-na-rm">na_rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p><code>[logical(1)]</code></p>
<p>Should missing values be removed from the computation?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A vector the same size as <code>x</code> containing the result of applying the
summary function over the sliding windows.</p><ul><li><p>For sliding sum, mean, prod, min, and max, a double vector will be
returned.</p></li>
<li><p>For sliding any and all, a logical vector will be returned.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that these functions are <em>not</em> generic and do not respect method
dispatch of the corresponding summary function (i.e. <code><a href="https://rdrr.io/r/base/sum.html" class="external-link">base::sum()</a></code>,
<code><a href="https://rdrr.io/r/base/mean.html" class="external-link">base::mean()</a></code>). Input will always be cast to a double or logical vector
using <code><a href="https://vctrs.r-lib.org/reference/vec_cast.html" class="external-link">vctrs::vec_cast()</a></code>, and an internal method for computing the summary
function will be used.</p>
<p>Due to the structure of segment trees, <code>slide_mean()</code> does not perform the
same "two pass" mean that <code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code> does (the intention of the second pass is
to perform a floating point error correction). Because of this, there may be
small differences between <code>slide_mean(x)</code> and <code>slide_dbl(x, mean)</code> in some
cases.</p>
    </div>
    <div class="section level2">
    <h2 id="implementation">Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a></h2>



<p>These variants are implemented using a data structure known as a
<em>segment tree</em>, which allows for extremely fast repeated range queries
without loss of precision.</p>
<p>One alternative to segment trees is to directly recompute the summary
function on each full window. This is what is done by using, for example,
<code>slide_dbl(x, sum)</code>. This is extremely slow with large window sizes and
wastes a lot of effort recomputing nearly the same information on each
window. It can be made slightly faster by moving the sum to C to avoid
intermediate allocations, but it still fairly slow.</p>
<p>A second alternative is to use an <em>online</em> algorithm, which uses information
from the previous window to compute the next window. These are extremely
fast, only requiring a single pass through the data, but often suffer from
numerical instability issues.</p>
<p>Segment trees are an attempt to reconcile the performance issues of the
direct approach with the numerical issues of the online approach. The
performance of segment trees isn't quite as fast as online algorithms, but is
close enough that it should be usable on most large data sets without any
issues. Unlike online algorithms, segment trees don't suffer from any
extra numerical instability issues.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Leis, Kundhikanjana, Kemper, and Neumann (2015). "Efficient Processing of
Window Functions in Analytical SQL Queries".
https://dl.acm.org/doi/10.14778/2794367.2794375</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="summary-index.html">slide_index_sum()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `slide_sum()` can be used for rolling sums.</span></span></span>
<span class="r-in"><span><span class="co"># The following are equivalent, but `slide_sum()` is much faster.</span></span></span>
<span class="r-in"><span><span class="fu">slide_sum</span><span class="op">(</span><span class="va">x</span>, before <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1  6  9 10 11 18</span>
<span class="r-in"><span><span class="fu"><a href="slide.html">slide_dbl</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">sum</span>, .before <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1  6  9 10 11 18</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># `slide_mean()` can be used for rolling averages</span></span></span>
<span class="r-in"><span><span class="fu">slide_mean</span><span class="op">(</span><span class="va">x</span>, before <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.000000 3.000000 3.000000 3.333333 3.666667 6.000000</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Only evaluate the sum on complete windows</span></span></span>
<span class="r-in"><span><span class="fu">slide_sum</span><span class="op">(</span><span class="va">x</span>, before <span class="op">=</span> <span class="fl">2</span>, after <span class="op">=</span> <span class="fl">1</span>, complete <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] NA NA 11 16 21 NA</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Skip every other calculation</span></span></span>
<span class="r-in"><span><span class="fu">slide_sum</span><span class="op">(</span><span class="va">x</span>, before <span class="op">=</span> <span class="fl">2</span>, step <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1 NA  9 NA 11 NA</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

  </div></footer></body></html>

